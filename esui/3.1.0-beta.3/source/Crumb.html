<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * ESUI (Enterprise Simple UI)
 * Copyright 2013 Baidu Inc. All rights reserved.
 *
 * @ignore
 * @file 面包屑导航控件
 * @author otakustay
 */
define(
    function (require) {
        var u = require(&#39;underscore&#39;);
        var lib = require(&#39;./lib&#39;);
        var Control = require(&#39;./Control&#39;);

<span id='Crumb-method-constructor'><span id='Crumb'>        /**
</span></span>         * 面包屑导航条
         *
         * 就是一个简单的导航条，通过{@link Crumb#separator}分隔每个节点
         *
         * @extends Control
         * @constructor
         */
        function Crumb() {
            Control.apply(this, arguments);
        }

<span id='Crumb-static-cfg-defaultProperties'>        /**
</span>         * @cfg defaultProperties
         *
         * 默认属性值
         *
         * @cfg {string} [defaultProperties.separator=&quot;&gt;&quot;] 节点分隔符
         * @static
         */
        Crumb.defaultProperties = {
            separator: &#39;&gt;&#39;
        };

<span id='Crumb-property-type'>        /**
</span>         * 控件类型，始终为`&quot;Crumb&quot;`
         *
         * @type {string}
         * @readonly
         * @override
         */
        Crumb.prototype.type = &#39;Crumb&#39;;

<span id='Crumb-method-initOptions'>        /**
</span>         * 初始化参数
         *
         * 如果初始化时未提供{@link Crumb#path}属性，则按以下规则构建该属性：
         *
         * 1. 获取主元素的所有子元素
         * 2. 对每个子元素，获取其文本内容为{@link meta.CrumbItem#text}属性
         * 3. 如果子元素是`&lt;a&gt;`元素，
         * 获取其`href`属性为配置项的{@link meta.CrumbItem#href}属性
         *
         * 因此 *不要* 在主元素下写分隔符
         *
         * @param {Object} [options] 构造函数传入的参数
         * @protected
         * @override
         */
        Crumb.prototype.initOptions = function (options) {
            var properties = {
                path: []
            };
            u.extend(properties, Crumb.defaultProperties, options);

            var children = lib.getChildren(this.main);
            if (!options.path &amp;&amp; children.length) {
                // 从HTML中拿到数据，HTML中不要写separator
                properties.path = u.map(
                    children,
                    function (element) {
                        var node = {
                            text: lib.getText(element)
                        };
                        if (element.nodeName.toLowerCase() === &#39;a&#39;) {
                            node.href = lib.getAttribute(element, &#39;href&#39;);
                        }

                        return node;
                    }
                );
            }

            this.setProperties(properties);
        };


<span id='Crumb-property-textNodeTemplate'>        /**
</span>         * 无链接的文字节点的内容HTML模板
         *
         * 模板中可以使用以下占位符：
         *
         * - `{string} text`：文本内容，经过HTML转义
         *
         * @type {string}
         */
        Crumb.prototype.textNodeTemplate =
            &#39;&lt;span class=&quot;${classes}&quot;&gt;${text}&lt;/span&gt;&#39;;

<span id='Crumb-property-linkNodeTemplate'>        /**
</span>         * 链接节点的内容HTML模板
         *
         * 模板中可以使用以下占位符：
         *
         * - `{string} text`：文本内容，经过HTML转义
         * - `{string} href`：链接地址，经过HTML转义
         *
         * @type {string}
         */
        Crumb.prototype.linkNodeTemplate =
            &#39;&lt;a class=&quot;${classes}&quot; href=&quot;${href}&quot;&gt;${text}&lt;/a&gt;&#39;;

<span id='Crumb-property-separatorTemplate'>        /**
</span>         * 分隔符HTML模板
         *
         * 模板中可以使用以下占位符：
         *
         * - `{string} classes`：节点需要使用的class名称
         * - `{string} text`：文本内容，经过HTML转义
         *
         * @type {string}
         */
        Crumb.prototype.separatorTemplate =
            &#39;&lt;span class=&quot;${classes}&quot;&gt;${text}&lt;/span&gt;&#39;;

<span id='Crumb-method-getNodeHTML'>        /**
</span>         * 获取节点的HTML内容
         *
         * @param {meta.CrumbItem} node 节点数据项
         * @param {number} index 节点索引序号
         * @return {string}
         */
        Crumb.prototype.getNodeHTML = function (node, index) {
            var classes = this.helper.getPartClasses(&#39;node&#39;);
            if (index === 0) {
                classes.push.apply(
                    classes,
                    this.helper.getPartClasses(&#39;node-first&#39;)
                );
            }
            if (index === this.path.length - 1) {
                classes.push.apply(
                    classes,
                    this.helper.getPartClasses(&#39;node-last&#39;)
                );
            }

            var template = node.href
                ? this.linkNodeTemplate
                : this.textNodeTemplate;
            var data = {
                href: u.escape(node.href),
                text: u.escape(node.text),
                classes: classes.join(&#39; &#39;)
            };
            return lib.format(template, data);
        };

<span id='Crumb-method-getSeparatorHTML'>        /**
</span>         * 获取分隔元素HTML内容
         *
         * @return {string}
         */
        Crumb.prototype.getSeparatorHTML = function () {
            return lib.format(
                this.separatorTemplate,
                {
                    classes: this.helper.getPartClassName(&#39;separator&#39;),
                    text: u.escape(this.separator)
                }
            );
        };

        var paint = require(&#39;./painters&#39;);
<span id='Crumb-method-repaint'>        /**
</span>         * 重渲染
         *
         * @method
         * @protected
         * @override
         */
        Crumb.prototype.repaint = paint.createRepaint(
            Control.prototype.repaint,
            {
<span id='Crumb-property-path'>                /**
</span>                 * @property {meta.CrumbItem[]} path
                 *
                 * 数据源配置，数组中的每一项生成一个节点
                 */

<span id='Crumb-property-separator'>                /**
</span>                 * @property {string} separator
                 *
                 * 分隔符，默认使用{@link Crumb#defaultProperties}中的配置
                 */
                name: [&#39;path&#39;, &#39;separator&#39;],
                paint: function (crumb, path) {
                    var html = u.map(path, crumb.getNodeHTML, crumb);
                    var separator = crumb.getSeparatorHTML();

                    crumb.main.innerHTML = html.join(separator);
                }
            }
        );

        require(&#39;./main&#39;).register(Crumb);
        lib.inherits(Crumb, Control);

        return Crumb;
    }
);
</pre>
</body>
</html>
